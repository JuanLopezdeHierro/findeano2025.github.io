<!DOCTYPE html>
<html class="dark" lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Fin de Año 2025 - Organización</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@100..900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#D4AF37",
                        "primary-hover": "#B5952F",
                        "background-dark": "#050505",
                        "surface-dark": "#121212",
                    },
                    fontFamily: {
                        "sans": ["Inter", "sans-serif"],
                        "serif": ["Playfair Display", "serif"],
                    },
                },
            },
        }
    </script>
    <style>
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(212, 175, 55, 0.15);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body class="bg-background-dark font-sans text-gray-200 overflow-x-hidden antialiased">
    <div class="flex min-h-screen w-full">
        <!-- Sidebar -->
        <aside
            class="hidden lg:flex w-[280px] flex-col border-r border-white/5 bg-[#0a0a0a] sticky top-0 h-screen overflow-y-auto">
            <div class="p-8">
                <div class="flex gap-4 items-center mb-10 cursor-pointer" onclick="showWelcome()">
                    <div class="bg-center bg-no-repeat bg-cover rounded-full size-12 ring-2 ring-primary/30">
                        <span class="material-symbols-outlined text-primary text-4xl">celebration</span>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-white text-xl font-serif font-bold">Fin de Año <span
                                class="text-primary">2025</span></h1>
                        <p class="text-gray-500 text-xs uppercase tracking-widest mt-0.5">Organización</p>
                    </div>
                </div>
                <nav class="flex flex-col gap-3">
                    <button onclick="switchTab('planning')" data-tab="planning"
                        class="tab-btn flex items-center gap-4 px-4 py-3.5 rounded-xl hover:bg-white/5 transition-all group border-l-2 border-transparent hover:border-white/20">
                        <span
                            class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">calendar_month</span>
                        <p class="text-gray-400 group-hover:text-white text-sm font-medium transition-colors">Planning
                        </p>
                    </button>
                    <button onclick="switchTab('equipo')" data-tab="equipo"
                        class="tab-btn flex items-center gap-4 px-4 py-3.5 rounded-xl hover:bg-white/5 transition-all group border-l-2 border-transparent hover:border-white/20">
                        <span
                            class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">groups</span>
                        <p class="text-gray-400 group-hover:text-white text-sm font-medium transition-colors">Equipo</p>
                    </button>
                    <button onclick="switchTab('tabla')" data-tab="tabla"
                        class="tab-btn flex items-center gap-4 px-4 py-3.5 rounded-xl hover:bg-white/5 transition-all group border-l-2 border-transparent hover:border-white/20">
                        <span
                            class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">account_balance_wallet</span>
                        <p class="text-gray-400 group-hover:text-white text-sm font-medium transition-colors">Tabla</p>
                    </button>
                    <button onclick="switchTab('evento')" data-tab="evento"
                        class="tab-btn flex items-center gap-4 px-4 py-3.5 rounded-xl hover:bg-white/5 transition-all group border-l-2 border-transparent hover:border-white/20">
                        <span
                            class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">diamond</span>
                        <p class="text-gray-400 group-hover:text-white text-sm font-medium transition-colors">Evento</p>
                    </button>
                    <button onclick="showWelcome()"
                        class="flex items-center gap-4 px-4 py-3.5 rounded-xl hover:bg-white/5 transition-all group border-l-2 border-transparent hover:border-white/20">
                        <span
                            class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">logout</span>
                        <p class="text-gray-400 group-hover:text-white text-sm font-medium transition-colors">Volver</p>
                    </button>
                </nav>
            </div>
            <div class="mt-auto p-6 border-t border-white/5">
                <div class="flex items-center gap-3">
                    <div
                        class="bg-center bg-no-repeat bg-cover rounded-full size-10 ring-1 ring-white/10 bg-primary/20 flex items-center justify-center">
                        <span class="text-primary font-bold text-lg" id="user-initial">U</span>
                    </div>
                    <div class="flex flex-col flex-1">
                        <span class="text-sm font-semibold text-white" id="current-user-name">Usuario</span>
                        <span class="text-xs text-primary">Miembro</span>
                    </div>
                    <button class="text-gray-500 hover:text-white transition-colors" onclick="showWelcome()">
                        <span class="material-symbols-outlined text-xl">logout</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0 overflow-hidden bg-background-dark relative">
            <div
                class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-primary/5 rounded-full blur-[120px] pointer-events-none">
            </div>

            <!-- Welcome Screen -->
            <div id="welcome-screen" class="flex-1 flex items-center justify-center p-8">
                <div class="max-w-md w-full glass-panel p-8 rounded-2xl text-center">
                    <div class="mb-6">
                        <span class="material-symbols-outlined text-primary text-6xl">celebration</span>
                    </div>
                    <h1 class="text-4xl font-serif font-bold text-white mb-4">
                        Bienvenida a <br /><span class="text-primary italic">Fin de Año 2025</span>
                    </h1>
                    <p class="text-gray-400 mb-6">Selecciona tu nombre para continuar</p>
                    <select id="user-select"
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white mb-4">
                        <option value="">Selecciona tu nombre...</option>
                    </select>
                    <button onclick="login()"
                        class="w-full bg-primary hover:bg-primary-hover text-black font-bold py-3 rounded-xl transition-all">
                        Entrar al Evento
                        <span class="material-symbols-outlined align-middle">arrow_forward</span>
                    </button>
                </div>
            </div>

            <!-- App Container (hidden initially) -->
            <div id="app-container" style="display: none;"
                class="flex-1 overflow-y-auto p-4 md:p-8 lg:p-12 pb-32 relative z-10">
                <div class="max-w-[1200px] mx-auto">

                    <!-- Planning Tab -->
                    <div id="planning-content" class="tab-content">
                        <div class="flex flex-col md:flex-row justify-between items-end gap-6 mb-8">
                            <div>
                                <h2 class="text-4xl md:text-5xl font-serif font-bold text-white mb-2">Centro de Tareas
                                </h2>
                                <p class="text-gray-400">Gestiona el inventario y el presupuesto en tiempo real.</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs text-gray-500 uppercase tracking-widest mb-1">Presupuesto Total</p>
                                <p class="text-3xl font-serif font-bold text-primary" id="total-budget">€222.50</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="glass-panel p-6 rounded-xl">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-primary/10 rounded-lg"><span
                                            class="material-symbols-outlined text-primary text-xl">account_balance</span>
                                    </div>
                                    <span class="text-xs font-bold uppercase tracking-widest text-gray-300">Límite
                                        Acordado</span>
                                </div>
                                <span class="text-2xl font-serif font-bold text-white">€222.50</span>
                            </div>
                            <div class="glass-panel p-6 rounded-xl">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-primary/10 rounded-lg"><span
                                            class="material-symbols-outlined text-primary text-xl">payments</span></div>
                                    <span
                                        class="text-xs font-bold uppercase tracking-widest text-gray-300">Gastado</span>
                                </div>
                                <span class="text-2xl font-serif font-bold text-white" id="total-spent">€0.00</span>
                            </div>
                            <div class="glass-panel p-6 rounded-xl">
                                <div class="flex items-center gap-3 mb-2">
                                    <div class="p-2 bg-primary/10 rounded-lg"><span
                                            class="material-symbols-outlined text-primary text-xl">savings</span></div>
                                    <span
                                        class="text-xs font-bold uppercase tracking-widest text-gray-300">Disponible</span>
                                </div>
                                <span class="text-2xl font-serif font-bold text-white"
                                    id="total-available">€222.50</span>
                            </div>
                        </div>

                        <div id="tasks-grid" class="grid gap-6">
                            <!-- Task categories will be loaded here -->
                        </div>
                    </div>

                    <!-- Equipo Tab -->
                    <div id="equipo-content" class="tab-content">
                        <h2 class="text-4xl font-serif font-bold text-white mb-6">El <span
                                class="text-primary italic">Séquito</span></h2>
                        <p class="text-gray-400 mb-8">Reparto de responsabilidades.</p>

                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="team-grid">
                            <!-- Team members will be loaded here -->
                        </div>
                    </div>

                    <!-- Tabla Tab -->
                    <div id="tabla-content" class="tab-content">
                        <h2 class="text-4xl font-serif font-bold text-white mb-6">
                            Visión <span class="text-primary">Financiera</span> Total
                        </h2>
                        <p class="text-gray-400 mb-8">Gestión de presupuesto para la celebración.</p>

                        <div class="glass-panel p-6 rounded-2xl">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-white/10">
                                        <th class="text-left p-4 text-primary text-sm font-bold uppercase">Tarea</th>
                                        <th class="text-left p-4 text-primary text-sm font-bold uppercase">Equipo</th>
                                        <th class="text-right p-4 text-primary text-sm font-bold uppercase">Gasto</th>
                                    </tr>
                                </thead>
                                <tbody id="tabla-body">
                                    <tr class="border-b border-white/5">
                                        <td class="p-4 text-white">Cargando...</td>
                                        <td class="p-4"></td>
                                        <td class="p-4 text-right text-primary">€0.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Evento Tab -->
                    <div id="evento-content" class="tab-content">
                        <div class="flex flex-col items-center justify-center min-h-[60vh] text-center">
                            <div class="glass-panel p-12 md:p-16 rounded-2xl max-w-2xl">
                                <span
                                    class="px-3 py-1 rounded-full border border-primary/50 text-primary text-xs uppercase font-bold tracking-widest">Invitación
                                    Oficial</span>
                                <h1 class="text-6xl md:text-8xl font-serif font-medium text-white mt-6 mb-8">
                                    Fin de <br /><span class="text-primary italic">Año 2025</span>
                                </h1>
                                <p class="text-gray-300 font-light max-w-lg leading-relaxed mb-8">
                                    Una velada exclusiva para nuestro círculo. Celebra el cierre de un ciclo y el
                                    comienzo de una nueva era con elegancia.
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                                    <div class="text-left">
                                        <span class="material-symbols-outlined text-4xl text-primary mb-2">styler</span>
                                        <h3 class="font-serif text-white text-xl mb-2">Dress Code</h3>
                                        <p class="text-gray-400 text-sm">Etiqueta Rigurosa</p>
                                    </div>
                                    <div class="text-left">
                                        <span
                                            class="material-symbols-outlined text-4xl text-primary mb-2">pin_drop</span>
                                        <h3 class="font-serif text-white text-xl mb-2">Ubicación</h3>
                                        <p class="text-gray-400 text-sm">Se revelará pronto</p>
                                    </div>
                                    <div class="text-left">
                                        <span
                                            class="material-symbols-outlined text-4xl text-primary mb-2">schedule</span>
                                        <h3 class="font-serif text-white text-xl mb-2">Horario</h3>
                                        <p class="text-gray-400 text-sm">Recepción: 21:00h</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script type="module" src="app.js"></script>
    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            // Show selected tab
            document.getElementById(tabName + '-content').classList.add('active');

            // Update button styles
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-primary/20', 'to-transparent', 'border-primary');
                btn.classList.add('border-transparent');
                btn.querySelector('span').classList.remove('text-primary');
                btn.querySelector('span').classList.add('text-gray-400');
                btn.querySelector('p').classList.remove('text-white', 'font-semibold');
                btn.querySelector('p').classList.add('text-gray-400');
            });

            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('bg-gradient-to-r', 'from-primary/20', 'to-transparent', 'border-primary');
                activeBtn.classList.remove('border-transparent');
                activeBtn.querySelector('span').classList.add('text-primary');
                activeBtn.querySelector('span').classList.remove('text-gray-400');
                activeBtn.querySelector('p').classList.add('text-white', 'font-semibold');
                activeBtn.querySelector('p').classList.remove('text-gray-400');
            }
        }

        // Login
        function login() {
            const userSelect = document.getElementById('user-select');
            const selectedUser = userSelect.value;

            if (!selectedUser) {
                alert('Por favor, selecciona tu nombre');
                return;
            }

            window.SheetApp.setCurrentUser(selectedUser);
            document.getElementById('current-user-name').textContent = selectedUser;
            document.getElementById('user-initial').textContent = selectedUser.charAt(0);

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';

            switchTab('planning');
            loadTeamData();
            loadPlanningData();
        }

        // Load Planning Data
        async function loadPlanningData() {
            const tasksGrid = document.getElementById('tasks-grid');
            const sheetData = await window.SheetApp.loadData();

            let totalSpent = 0;

            window.SheetApp.CATEGORIES.forEach(category => {
                const categoryData = sheetData[category.id] || { assignedTo: [], details: '', cost: 0 };
                const cost = categoryData.cost || 0;
                totalSpent += cost;

                const taskCard = createTaskCard(category, categoryData);
                tasksGrid.appendChild(taskCard);
            });

            updateBudgetDisplay(totalSpent);
        }

        function createTaskCard(category, data) {
            const div = document.createElement('div');
            div.className = 'glass-panel p-6 rounded-2xl';

            const currentUser = window.SheetApp.getCurrentUser();
            const isAssigned = data.assignedTo && data.assignedTo.includes(currentUser);
            const canEdit = isAssigned;

            div.innerHTML = `
                <div class="flex flex-col md:flex-row justify-between gap-6">
                    <div class="flex items-start gap-5">
                        <div class="size-14 rounded-2xl ${canEdit ? 'bg-primary/10 text-primary border border-primary/20' : 'bg-white/5 text-gray-500'} flex items-center justify-center text-2xl">
                            <span class="material-symbols-outlined">${category.icon}</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="text-2xl font-serif font-bold text-white">${category.name}</h3>
                                ${!canEdit ? '<span class="material-symbols-outlined text-gray-600 text-sm">lock</span>' : ''}
                            </div>
                            <p class="text-gray-400 text-sm mb-3">${data.details || 'Sin detalles aún...'}</p>
                            <div class="flex flex-wrap gap-2">
                                ${(data.assignedTo || []).map(u => `
                                    <span class="px-2 py-1 bg-white/5 rounded-md text-xs text-gray-300 border border-white/5 flex items-center gap-1">
                                        <div class="size-2 rounded-full bg-primary/50"></div>
                                        ${u}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-3 min-w-[140px] items-end">
                        <div class="text-right">
                            <p class="text-xs text-gray-500 uppercase tracking-wide">Gastado</p>
                            <p class="text-2xl font-serif font-bold ${data.cost > category.limit ? 'text-red-400' : 'text-primary'}">€${(data.cost || 0).toFixed(2)}</p>
                            <p class="text-xs text-gray-600">Límite: €${category.limit}</p>
                        </div>
                        <button onclick="toggleAssignment('${category.id}')" 
                            class="px-6 py-2 rounded-xl font-bold text-sm transition-all ${isAssigned ? 'bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20' : 'bg-primary/10 text-primary border border-primary/20 hover:bg-primary hover:text-black'}">
                            ${isAssigned ? 'Salir' : 'Entrar'}
                        </button>
                    </div>
                </div>
            `;

            return div;
        }

        async function toggleAssignment(categoryId) {
            const currentUser = window.SheetApp.getCurrentUser();
            if (!currentUser) {
                alert('Debes iniciar sesión');
                return;
            }

            const sheetData = await window.SheetApp.loadData();
            const categoryData = sheetData[categoryId] || { assignedTo: [], details: '', cost: 0 };

            let newAssignedTo = categoryData.assignedTo || [];
            if (newAssignedTo.includes(currentUser)) {
                newAssignedTo = newAssignedTo.filter(u => u !== currentUser);
            } else {
                newAssignedTo = [...newAssignedTo, currentUser];
            }

            await window.SheetApp.saveData(categoryId, categoryData.details, newAssignedTo, categoryData.cost);

            // Reload planning data
            document.getElementById('tasks-grid').innerHTML = '';
            loadPlanningData();
        }

        function updateBudgetDisplay(totalSpent) {
            const totalBudget = 222.50;
            const available = totalBudget - totalSpent;

            document.getElementById('total-spent').textContent = '€' + totalSpent.toFixed(2);
            document.getElementById('total-available').textContent = '€' + available.toFixed(2);
        }

        // Show welcome
        function showWelcome() {
            localStorage.removeItem('currentUser');
            document.getElementById('welcome-screen').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
        }

        // Load team data
        function loadTeamData() {
            const teamGrid = document.getElementById('team-grid');
            window.SheetApp.USERS.forEach((user, i) => {
                const card = document.createElement('div');
                card.className = 'glass-panel p-4 rounded-xl hover:bg-white/5 transition-all';
                card.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="size-12 rounded-full border-2 ${i < 3 ? 'border-primary text-primary' : 'border-white/10 text-gray-500'} bg-surface-dark flex items-center justify-center text-lg font-bold">
                            ${user.charAt(0)}
                        </div>
                        <div>
                            <h4 class="text-white font-medium">${user}</h4>
                            <p class="text-xs text-gray-400">0 tareas</p>
                        </div>
                    </div>
                `;
                teamGrid.appendChild(card);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Populate user select
            const userSelect = document.getElementById('user-select');
            window.SheetApp.USERS.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                userSelect.appendChild(option);
            });

            // Check for existing user
            const currentUser = window.SheetApp.getCurrentUser();
            if (currentUser) {
                userSelect.value = currentUser;
                login();
            }
        });
    </script>
</body>

</html>